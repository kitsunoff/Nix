# –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Home Manager

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### ‚úÖ –£–ª—É—á—à–µ–Ω–∏—è

1. **–£–±—Ä–∞–Ω—ã bash-—Å–∫—Ä–∏–ø—Ç—ã** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è OpenCode —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è
1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π** - –°–∏—Å—Ç–µ–º–Ω—ã–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã
1. **Home Manager –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ dotfiles –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏
1. **XDG-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –§–∞–π–ª—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–∞–∫ —Å–∏–º–ª–∏–Ω–∫–∏ –≤ `~/.config/`

### üìÅ –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
my-nixos/
‚îú‚îÄ‚îÄ flake.nix                          # ‚ú® –î–æ–±–∞–≤–ª–µ–Ω home-manager input
‚îú‚îÄ‚îÄ darwin/MacBook-Pro-Maxim/
‚îÇ   ‚îî‚îÄ‚îÄ default.nix                    # ‚ú® –£–±—Ä–∞–Ω opencode.nix import
‚îú‚îÄ‚îÄ home/
‚îÇ   ‚îî‚îÄ‚îÄ kitsunoff.nix                  # üÜï –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ opencode.nix               # ‚ö†Ô∏è  –£—Å—Ç–∞—Ä–µ–ª (–Ω–µ —É–¥–∞–ª—è—Ç—å –ø–æ–∫–∞)
‚îÇ   ‚îî‚îÄ‚îÄ home-manager/
‚îÇ       ‚îî‚îÄ‚îÄ opencode.nix               # üÜï –ù–æ–≤—ã–π home-manager –º–æ–¥—É–ª—å
```

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ flake.lock

```bash
cd ~/my-nixos
sudo chown kitsunoff:staff flake.lock
nix flake update
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
darwin-rebuild check --flake .#MacBook-Pro-Maxim
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
darwin-rebuild switch --flake .#MacBook-Pro-Maxim
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ:

- Home Manager —Å–æ–∑–¥–∞—Å—Ç —Å–∏–º–ª–∏–Ω–∫–∏ –≤ `~/.config/`
- –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã (—Å–æ–∑–¥–∞—Å—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å `.backup`)

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é OpenCode
ls -la ~/.config/opencode/

# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# opencode.json -> /nix/store/xxx-opencode.json
# agents -> /nix/store/xxx-agents

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
cat ~/.config/opencode/opencode.json
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `home/kitsunoff.nix` –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:

### OpenCode

```nix
programs.opencode = {
  enable = true;
  
  # Custom agents from dotfiles
  agents = ../dotfiles/agents;
  
  # OpenCode settings (creates opencode.json)
  settings = {
    plugin = [ "opencode-alibaba-qwen3-auth" ];
    model = "alibaba/coder-model";
  };
};
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ú—ã —Ä–∞—Å—à–∏—Ä—è–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å Home Manager –¥–ª—è OpenCode, –¥–æ–±–∞–≤–ª—è—è —É–¥–æ–±–Ω—ã–µ –æ–ø—Ü–∏–∏ (`plugins`, `defaultModel`, `agentsPath`, `extraConfig`). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π API –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –º–æ–¥—É–ª–µ–º.

### Git

```nix
programs.git = {
  enable = true;
  userName = "kitsunoff";
  userEmail = "your@email.com";  # ‚ö†Ô∏è –£–∫–∞–∂–∏—Ç–µ —Å–≤–æ–π email
};
```

### Zsh

```nix
programs.zsh = {
  enable = true;
  oh-my-zsh = {
    enable = true;
    theme = "robbyrussell";
  };
};
```

## –û—Ç–∫–∞—Ç –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# –û—Ç–∫–∞—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
darwin-rebuild switch --rollback

# –°–ø–∏—Å–æ–∫ –ø–æ–∫–æ–ª–µ–Ω–∏–π
nix-env --list-generations
```

## –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å:

```bash
# –°—Ç–∞—Ä—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–¥—É–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
rm modules/common/opencode.nix

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±–æ–ª—å—à–µ –Ω–∏–≥–¥–µ –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è
rg "modules/common/opencode.nix" .
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ home-manager –∏–∑–º–µ–Ω–µ–Ω–∏—è (–±—ã—Å—Ç—Ä–µ–µ)
home-manager switch --flake .

# –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–ª–∏—á–∏—è –¥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
darwin-rebuild build --flake .#MacBook-Pro-Maxim
nvd diff /run/current-system ./result

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–º–ª–∏–Ω–∫–∏ home-manager
home-manager packages
```

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤

–ï—Å–ª–∏ home-manager –∂–∞–ª—É–µ—Ç—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã:

```bash
# –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
mv ~/.config/opencode ~/.config/opencode.backup

# –ó–∞—Ç–µ–º –ø–æ–≤—Ç–æ—Ä–∏—Ç—å switch
darwin-rebuild switch --flake .#MacBook-Pro-Maxim
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

```bash
# –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –∏ –ø–µ—Ä–µ—Å—Ç—Ä–æ–∏—Ç—å
nix-collect-garbage -d
darwin-rebuild switch --flake .#MacBook-Pro-Maxim --recreate-lock-file
```

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏

1. –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ dotfiles –≤ home-manager (vim, tmux, etc.)
1. –ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ –ø–∞–∫–µ—Ç—ã –∏–∑ `environment.systemPackages` –≤ `home.packages`
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ shell-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (starship, fzf, etc.)

–°–º. [README.md](./README.md) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π.
